<!DOCTYPE html>
<html lang="en" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom scrollbar for a more polished look */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #dbf6fa;
        }
        .dark ::-webkit-scrollbar-track {
            background: #273f43;
        }
        ::-webkit-scrollbar-thumb {
            background: #00424a;
            border-radius: 10px;
        }
        .dark ::-webkit-scrollbar-thumb {
            background: #bac6ea;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #2f3b58;
        }
        .dark ::-webkit-scrollbar-thumb:hover {
            background: #edfcff;
        }
        /* Animation for modals */
        .modal-enter {
            opacity: 0;
            transform: scale(0.95);
        }
        .modal-enter-active {
            opacity: 1;
            transform: scale(1);
            transition: opacity 300ms, transform 300ms;
        }
        .modal-leave {
            opacity: 1;
            transform: scale(1);
        }
        .modal-leave-active {
            opacity: 0;
            transform: scale(0.95);
            transition: opacity 300ms, transform 300ms;
        }
        /* Custom focus ring */
        .custom-focus-ring:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(47, 59, 88, 0.5);
        }
        .dark .custom-focus-ring:focus {
            box-shadow: 0 0 0 3px rgba(186, 198, 234, 0.6);
        }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'primary-dark': '#00424a',
                        'primary-light': '#edfcff',
                        'secondary-dark': '#273f43',
                        'secondary-light': '#dbf6fa',
                        'tertiary-dark': '#2f3b58',
                        'tertiary-light': '#bac6ea',
                        'app-bg': '#cde7ec',
                        'error': '#de3730',
                        'neutral-dark': '#393c3d',
                        'neutral-light': '#f8fafa',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-app-bg dark:bg-secondary-dark font-sans text-neutral-dark dark:text-neutral-light transition-colors duration-300">

    <div id="app" class="min-h-screen p-4 sm:p-6 lg:p-8">
        <div class="max-w-7xl mx-auto">
            <!-- Header -->
            <header class="flex justify-between items-center mb-6">
                <h1 class="text-2xl sm:text-3xl font-bold text-primary-dark dark:text-primary-light">InventoryPro</h1>
                <div class="flex items-center space-x-4">
                    <button id="addItemBtn" class="flex items-center bg-primary-dark hover:bg-tertiary-dark text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all duration-300 custom-focus-ring">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                        </svg>
                        <span class="hidden sm:inline">Add Item</span>
                    </button>
                    <button id="theme-toggle" class="p-2 rounded-full bg-secondary-light dark:bg-tertiary-dark text-primary-dark dark:text-primary-light custom-focus-ring transition-colors duration-300">
                        <svg id="theme-icon-light" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                        <svg id="theme-icon-dark" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                    </button>
                </div>
            </header>

            <!-- Filters -->
            <div class="bg-primary-light dark:bg-secondary-dark p-4 rounded-lg shadow-md mb-6">
                <details open>
                    <summary class="font-semibold text-lg cursor-pointer text-primary-dark dark:text-primary-light flex justify-between items-center">
                        <span>Filters & Search</span>
                        <svg class="w-6 h-6 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </summary>
                    <div id="filters" class="mt-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div>
                            <label for="search" class="block text-sm font-medium text-neutral-dark dark:text-neutral-light mb-1">Search by Name</label>
                            <input type="text" id="search" placeholder="e.g., Laptop" class="w-full p-2 rounded-md bg-white dark:bg-tertiary-dark border border-tertiary-light dark:border-tertiary-dark custom-focus-ring">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-neutral-dark dark:text-neutral-light mb-1">Quantity Range</label>
                            <div class="flex space-x-2">
                                <input type="number" id="minQty" placeholder="Min" class="w-1/2 p-2 rounded-md bg-white dark:bg-tertiary-dark border border-tertiary-light dark:border-tertiary-dark custom-focus-ring">
                                <input type="number" id="maxQty" placeholder="Max" class="w-1/2 p-2 rounded-md bg-white dark:bg-tertiary-dark border border-tertiary-light dark:border-tertiary-dark custom-focus-ring">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-neutral-dark dark:text-neutral-light mb-1">Date Added Range</label>
                            <div class="flex space-x-2">
                                <input type="date" id="startDate" class="w-1/2 p-2 rounded-md bg-white dark:bg-tertiary-dark border border-tertiary-light dark:border-tertiary-dark custom-focus-ring">
                                <input type="date" id="endDate" class="w-1/2 p-2 rounded-md bg-white dark:bg-tertiary-dark border border-tertiary-light dark:border-tertiary-dark custom-focus-ring">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-neutral-dark dark:text-neutral-light mb-1">Storage Location</label>
                            <div id="locationFilters" class="max-h-24 overflow-y-auto space-y-1 p-2 bg-white dark:bg-tertiary-dark rounded-md border border-tertiary-light dark:border-tertiary-dark">
                                <!-- Location checkboxes will be injected here -->
                            </div>
                        </div>
                    </div>
                </details>
            </div>

            <!-- Inventory Table -->
            <div class="bg-primary-light dark:bg-secondary-dark rounded-lg shadow-lg overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full min-w-[640px]">
                        <thead class="bg-secondary-light dark:bg-tertiary-dark">
                            <tr>
                                <th class="p-4 text-left text-sm font-semibold uppercase tracking-wider cursor-pointer" data-sort="name">Name</th>
                                <th class="p-4 text-left text-sm font-semibold uppercase tracking-wider cursor-pointer" data-sort="quantity">Quantity</th>
                                <th class="p-4 text-left text-sm font-semibold uppercase tracking-wider cursor-pointer" data-sort="location">Location</th>
                                <th class="p-4 text-left text-sm font-semibold uppercase tracking-wider cursor-pointer" data-sort="dateAdded">Date Added</th>
                                <th class="p-4 text-left text-sm font-semibold uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="inventory-table-body">
                            <!-- Rows will be injected here -->
                        </tbody>
                    </table>
                </div>
                <div id="no-results" class="hidden text-center p-8 text-neutral-dark dark:text-neutral-light">
                    <p class="text-lg font-medium">No items found.</p>
                    <p class="text-sm">Try adjusting your filters or add a new item.</p>
                </div>
            </div>

            <!-- Pagination -->
            <div id="pagination" class="mt-6 flex justify-between items-center flex-wrap gap-2">
                <!-- Pagination controls will be injected here -->
            </div>
        </div>
    </div>

    <!-- Add/Edit Item Modal -->
    <div id="itemModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-primary-light dark:bg-secondary-dark rounded-lg shadow-xl w-full max-w-md p-6 modal-enter">
            <h2 id="modalTitle" class="text-2xl font-bold mb-4 text-primary-dark dark:text-primary-light">Add New Item</h2>
            <form id="itemForm">
                <input type="hidden" id="itemId">
                <div class="mb-4">
                    <label for="itemName" class="block text-sm font-medium mb-1">Item Name</label>
                    <input type="text" id="itemName" required class="w-full p-2 rounded-md bg-white dark:bg-tertiary-dark border border-tertiary-light dark:border-tertiary-dark custom-focus-ring">
                </div>
                <div class="mb-4">
                    <label for="itemQuantity" class="block text-sm font-medium mb-1">Quantity</label>
                    <input type="number" id="itemQuantity" required min="0" class="w-full p-2 rounded-md bg-white dark:bg-tertiary-dark border border-tertiary-light dark:border-tertiary-dark custom-focus-ring">
                </div>
                <div class="mb-6">
                    <label for="itemLocation" class="block text-sm font-medium mb-1">Storage Location</label>
                    <input type="text" id="itemLocation" required class="w-full p-2 rounded-md bg-white dark:bg-tertiary-dark border border-tertiary-light dark:border-tertiary-dark custom-focus-ring">
                </div>
                <div class="flex justify-end space-x-4">
                    <button type="button" id="cancelBtn" class="py-2 px-4 rounded-lg bg-neutral-light dark:bg-neutral-dark text-neutral-dark dark:text-neutral-light hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors custom-focus-ring">Cancel</button>
                    <button type="submit" id="saveBtn" class="py-2 px-6 rounded-lg bg-primary-dark hover:bg-tertiary-dark text-white font-bold transition-colors custom-focus-ring">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-primary-light dark:bg-secondary-dark rounded-lg shadow-xl w-full max-w-sm p-6 modal-enter">
            <h2 class="text-xl font-bold mb-4 text-primary-dark dark:text-primary-light">Confirm Deletion</h2>
            <p class="mb-6">Are you sure you want to delete this item? This action cannot be undone.</p>
            <div class="flex justify-end space-x-4">
                <button id="confirmCancelBtn" class="py-2 px-4 rounded-lg bg-neutral-light dark:bg-neutral-dark text-neutral-dark dark:text-neutral-light hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors custom-focus-ring">Cancel</button>
                <button id="confirmDeleteBtn" class="py-2 px-4 rounded-lg bg-error text-white font-bold hover:bg-red-700 transition-colors custom-focus-ring">Delete</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- STATE MANAGEMENT ---
            let inventory = [];
            let filteredInventory = [];
            let currentPage = 1;
            const itemsPerPage = 10;
            let sortConfig = { key: 'dateAdded', direction: 'desc' };
            let itemToDeleteId = null;

            // --- DOM ELEMENTS ---
            const themeToggle = document.getElementById('theme-toggle');
            const themeIconLight = document.getElementById('theme-icon-light');
            const themeIconDark = document.getElementById('theme-icon-dark');
            const addItemBtn = document.getElementById('addItemBtn');
            const itemModal = document.getElementById('itemModal');
            const confirmModal = document.getElementById('confirmModal');
            const cancelBtn = document.getElementById('cancelBtn');
            const confirmCancelBtn = document.getElementById('confirmCancelBtn');
            const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
            const itemForm = document.getElementById('itemForm');
            const tableBody = document.getElementById('inventory-table-body');
            const paginationContainer = document.getElementById('pagination');
            const filterInputs = document.querySelectorAll('#filters input, #filters select');
            const locationFiltersContainer = document.getElementById('locationFilters');
            const noResultsDiv = document.getElementById('no-results');

            // --- INITIALIZATION ---
            const init = () => {
                loadTheme();
                loadInventory();
                addEventListeners();
                render();
            };

            // --- THEME ---
            const loadTheme = () => {
                if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                    document.documentElement.classList.add('dark');
                    themeIconLight.classList.add('hidden');
                    themeIconDark.classList.remove('hidden');
                } else {
                    document.documentElement.classList.remove('dark');
                    themeIconLight.classList.remove('hidden');
                    themeIconDark.classList.add('hidden');
                }
            };

            const toggleTheme = () => {
                const isDark = document.documentElement.classList.toggle('dark');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                themeIconLight.classList.toggle('hidden', isDark);
                themeIconDark.classList.toggle('hidden', !isDark);
            };

            // --- DATA PERSISTENCE ---
            const getInitialData = () => {
                return [
                    { id: Date.now() + 1, name: 'Ergonomic Keyboard', quantity: 75, location: 'Office Supplies', dateAdded: '2023-11-10T09:00:00Z' },
                    { id: Date.now() + 2, name: '4K Monitor 27"', quantity: 30, location: 'Warehouse B', dateAdded: '2023-11-08T15:20:00Z' },
                    { id: Date.now() + 3, name: 'Docking Station', quantity: 50, location: 'IT Department', dateAdded: '2023-11-05T11:45:00Z' },
                    { id: Date.now() + 4, name: 'Webcam HD Pro', quantity: 120, location: 'Warehouse A', dateAdded: '2023-11-01T18:00:00Z' },
                    { id: Date.now() + 5, name: 'Laptop Pro 15"', quantity: 25, location: 'Warehouse A', dateAdded: '2023-10-26T10:00:00Z' },
                    { id: Date.now() + 6, name: 'Wireless Mouse', quantity: 150, location: 'Office Supplies', dateAdded: '2023-10-25T14:30:00Z' },
                    { id: Date.now() + 7, name: 'Standing Desk', quantity: 15, location: 'Warehouse B', dateAdded: '2023-10-22T08:00:00Z' },
                    { id: Date.now() + 8, name: 'Noise-Cancelling Headphones', quantity: 60, location: 'IT Department', dateAdded: '2023-10-20T12:10:00Z' },
                    { id: Date.now() + 9, name: 'USB-C Hub', quantity: 200, location: 'Warehouse A', dateAdded: '2023-10-18T16:50:00Z' },
                    { id: Date.now() + 10, name: 'Office Chair', quantity: 40, location: 'Warehouse B', dateAdded: '2023-10-15T10:00:00Z' },
                    { id: Date.now() + 11, name: 'Printer Ink (Black)', quantity: 300, location: 'Office Supplies', dateAdded: '2023-10-12T13:25:00Z' },
                    { id: Date.now() + 12, name: 'Whiteboard Markers', quantity: 500, location: 'Office Supplies', dateAdded: '2023-10-10T09:30:00Z' },
                ];
            };

            const loadInventory = () => {
                const storedInventory = localStorage.getItem('inventory');
                if (storedInventory) {
                    inventory = JSON.parse(storedInventory);
                } else {
                    inventory = getInitialData();
                    saveInventory();
                }
            };

            const saveInventory = () => {
                localStorage.setItem('inventory', JSON.stringify(inventory));
            };

            // --- MODAL HANDLING ---
            const openModal = (mode, item = null) => {
                itemForm.reset();
                const modalTitle = document.getElementById('modalTitle');
                const itemIdInput = document.getElementById('itemId');
                if (mode === 'add') {
                    modalTitle.textContent = 'Add New Item';
                    itemIdInput.value = '';
                } else {
                    modalTitle.textContent = 'Edit Item';
                    itemIdInput.value = item.id;
                    document.getElementById('itemName').value = item.name;
                    document.getElementById('itemQuantity').value = item.quantity;
                    document.getElementById('itemLocation').value = item.location;
                }
                itemModal.classList.remove('hidden');
                setTimeout(() => itemModal.firstElementChild.classList.add('modal-enter-active'), 10);
            };

            const closeModal = (modal) => {
                modal.firstElementChild.classList.remove('modal-enter-active');
                modal.firstElementChild.classList.add('modal-leave-active');
                setTimeout(() => {
                    modal.classList.add('hidden');
                    modal.firstElementChild.classList.remove('modal-leave-active');
                }, 300);
            };

            const openConfirmModal = (id) => {
                itemToDeleteId = id;
                confirmModal.classList.remove('hidden');
                setTimeout(() => confirmModal.firstElementChild.classList.add('modal-enter-active'), 10);
            };

            // --- CRUD OPERATIONS ---
            const handleFormSubmit = (e) => {
                e.preventDefault();
                const id = document.getElementById('itemId').value;
                const newItem = {
                    name: document.getElementById('itemName').value,
                    quantity: parseInt(document.getElementById('itemQuantity').value, 10),
                    location: document.getElementById('itemLocation').value,
                };

                if (id) { // Update
                    const index = inventory.findIndex(item => item.id == id);
                    if (index !== -1) {
                        inventory[index] = { ...inventory[index], ...newItem };
                    }
                } else { // Add
                    newItem.id = Date.now();
                    newItem.dateAdded = new Date().toISOString();
                    inventory.push(newItem);
                }
                saveInventory();
                render();
                closeModal(itemModal);
            };

            const handleDelete = () => {
                inventory = inventory.filter(item => item.id !== itemToDeleteId);
                saveInventory();
                render();
                closeModal(confirmModal);
                itemToDeleteId = null;
            };

            // --- RENDERING ---
            const render = () => {
                applyFiltersAndSort();
                renderTable();
                renderPagination();
                renderLocationFilters();
            };

            const renderTable = () => {
                tableBody.innerHTML = '';
                const startIndex = (currentPage - 1) * itemsPerPage;
                const endIndex = startIndex + itemsPerPage;
                const pageItems = filteredInventory.slice(startIndex, endIndex);

                if (pageItems.length === 0) {
                    noResultsDiv.classList.remove('hidden');
                    tableBody.parentElement.parentElement.classList.add('hidden');
                } else {
                    noResultsDiv.classList.add('hidden');
                    tableBody.parentElement.parentElement.classList.remove('hidden');
                }

                pageItems.forEach(item => {
                    const row = document.createElement('tr');
                    row.className = 'border-b border-secondary-light dark:border-tertiary-dark hover:bg-secondary-light dark:hover:bg-tertiary-dark transition-colors';
                    row.innerHTML = `
                        <td class="p-4 whitespace-nowrap">
                            <div class="font-medium">${item.name}</div>
                        </td>
                        <td class="p-4 whitespace-nowrap">${item.quantity}</td>
                        <td class="p-4 whitespace-nowrap">${item.location}</td>
                        <td class="p-4 whitespace-nowrap">${new Date(item.dateAdded).toLocaleDateString()}</td>
                        <td class="p-4 whitespace-nowrap">
                            <button class="edit-btn p-2 text-tertiary-dark dark:text-tertiary-light hover:text-primary-dark dark:hover:text-primary-light" data-id="${item.id}" title="Edit">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" /></svg>
                            </button>
                            <button class="delete-btn p-2 text-error hover:text-red-700" data-id="${item.id}" title="Delete">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
                            </button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            };

            const renderPagination = () => {
                const totalPages = Math.ceil(filteredInventory.length / itemsPerPage);
                paginationContainer.innerHTML = '';

                if (totalPages <= 1) return;

                let paginationHTML = `<div class="text-sm text-neutral-dark dark:text-neutral-light">Showing ${Math.min((currentPage - 1) * itemsPerPage + 1, filteredInventory.length)} to ${Math.min(currentPage * itemsPerPage, filteredInventory.length)} of ${filteredInventory.length} results</div>`;
                
                paginationHTML += '<div class="flex items-center space-x-1">';

                // Previous button
                paginationHTML += `<button class="page-btn p-2 rounded-md ${currentPage === 1 ? 'opacity-50 cursor-not-allowed' : 'hover:bg-secondary-light dark:hover:bg-tertiary-dark'}" ${currentPage === 1 ? 'disabled' : ''} data-page="${currentPage - 1}">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                </button>`;

                // Page numbers
                for (let i = 1; i <= totalPages; i++) {
                    if (i === currentPage) {
                        paginationHTML += `<button class="page-btn w-8 h-8 rounded-md bg-primary-dark text-white font-bold" disabled data-page="${i}">${i}</button>`;
                    } else {
                        paginationHTML += `<button class="page-btn w-8 h-8 rounded-md hover:bg-secondary-light dark:hover:bg-tertiary-dark" data-page="${i}">${i}</button>`;
                    }
                }

                // Next button
                paginationHTML += `<button class="page-btn p-2 rounded-md ${currentPage === totalPages ? 'opacity-50 cursor-not-allowed' : 'hover:bg-secondary-light dark:hover:bg-tertiary-dark'}" ${currentPage === totalPages ? 'disabled' : ''} data-page="${currentPage + 1}">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg>
                </button>`;
                
                paginationHTML += '</div>';
                paginationContainer.innerHTML = paginationHTML;
            };

            const renderLocationFilters = () => {
                const locations = [...new Set(inventory.map(item => item.location))].sort();
                const checkedLocations = Array.from(document.querySelectorAll('#locationFilters input:checked')).map(cb => cb.value);
                
                locationFiltersContainer.innerHTML = locations.map(location => `
                    <div class="flex items-center">
                        <input type="checkbox" id="loc-${location.replace(/\s+/g, '-')}" value="${location}" class="h-4 w-4 rounded border-gray-300 text-primary-dark focus:ring-primary-dark" ${checkedLocations.includes(location) ? 'checked' : ''}>
                        <label for="loc-${location.replace(/\s+/g, '-')}" class="ml-2 text-sm">${location}</label>
                    </div>
                `).join('');
            };

            // --- FILTERING & SORTING ---
            const applyFiltersAndSort = () => {
                const searchTerm = document.getElementById('search').value.toLowerCase();
                const minQty = parseInt(document.getElementById('minQty').value, 10) || 0;
                const maxQty = parseInt(document.getElementById('maxQty').value, 10) || Infinity;
                const startDate = document.getElementById('startDate').value;
                const endDate = document.getElementById('endDate').value;
                const selectedLocations = Array.from(document.querySelectorAll('#locationFilters input:checked')).map(cb => cb.value);

                filteredInventory = inventory.filter(item => {
                    const itemDate = new Date(item.dateAdded);
                    const start = startDate ? new Date(startDate) : null;
                    const end = endDate ? new Date(endDate) : null;
                    if(end) end.setHours(23, 59, 59, 999); // Include the whole end day

                    return (
                        item.name.toLowerCase().includes(searchTerm) &&
                        item.quantity >= minQty &&
                        item.quantity <= maxQty &&
                        (!start || itemDate >= start) &&
                        (!end || itemDate <= end) &&
                        (selectedLocations.length === 0 || selectedLocations.includes(item.location))
                    );
                });

                filteredInventory.sort((a, b) => {
                    const aVal = a[sortConfig.key];
                    const bVal = b[sortConfig.key];
                    let comparison = 0;
                    if (aVal > bVal) {
                        comparison = 1;
                    } else if (aVal < bVal) {
                        comparison = -1;
                    }
                    return sortConfig.direction === 'asc' ? comparison : -comparison;
                });
            };

            const handleFilterChange = () => {
                currentPage = 1;
                render();
            };

            const handleSort = (e) => {
                const key = e.target.closest('th').dataset.sort;
                if (!key) return;

                if (sortConfig.key === key) {
                    sortConfig.direction = sortConfig.direction === 'asc' ? 'desc' : 'asc';
                } else {
                    sortConfig.key = key;
                    sortConfig.direction = 'asc';
                }
                currentPage = 1;
                render();
            };

            // --- EVENT LISTENERS ---
            const addEventListeners = () => {
                themeToggle.addEventListener('click', toggleTheme);
                addItemBtn.addEventListener('click', () => openModal('add'));
                cancelBtn.addEventListener('click', () => closeModal(itemModal));
                itemForm.addEventListener('submit', handleFormSubmit);
                
                confirmCancelBtn.addEventListener('click', () => closeModal(confirmModal));
                confirmDeleteBtn.addEventListener('click', handleDelete);

                tableBody.addEventListener('click', (e) => {
                    const editBtn = e.target.closest('.edit-btn');
                    if (editBtn) {
                        const item = inventory.find(i => i.id == editBtn.dataset.id);
                        if (item) openModal('edit', item);
                    }
                    const deleteBtn = e.target.closest('.delete-btn');
                    if (deleteBtn) {
                        openConfirmModal(parseInt(deleteBtn.dataset.id, 10));
                    }
                });

                paginationContainer.addEventListener('click', (e) => {
                    const pageBtn = e.target.closest('.page-btn');
                    if (pageBtn && !pageBtn.disabled) {
                        currentPage = parseInt(pageBtn.dataset.page, 10);
                        render();
                    }
                });

                document.querySelector('thead').addEventListener('click', handleSort);

                filterInputs.forEach(input => input.addEventListener('input', handleFilterChange));
                locationFiltersContainer.addEventListener('change', handleFilterChange);
            };

            // --- START THE APP ---
            init();
        });
    </script>
</body>
</html>
